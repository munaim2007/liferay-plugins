<?xml version="1.0"?>
<!DOCTYPE project>

<project name="build-common-shared">
	<import file="../build-common-plugin.xml" />

	<if>
		<available file="${sdk.dir}/shared/portal-compat-shared" />
		<then>
			<property name="plugin-lib.classpath.path" refid="plugin-lib.classpath" />

			<path id="plugin-lib.classpath">
				<pathelement path="${plugin-lib.classpath.path}" />
				<pathelement location="${sdk.dir}/shared/portal-compat-shared/classes" />
			</path>

			<var name="plugin-lib.classpath.path" unset="true" />
		</then>
	</if>

	<target name="clean">
		<delete dir="classes" />
		<delete dir="javadoc" />
		<delete file="${plugin.pom.file}" />
		<delete file="${plugin.sources.file}" />
		<delete file="${plugin.javadoc.file}" />

		<antcall target="build-common-plugin.clean" />
	</target>

	<target name="compile">
		<if>
			<and>
				<available file="${sdk.dir}/shared/portal-compat-shared" />
				<not>
					<equals arg1="${plugin.name}" arg2="portal-compat-shared" />
				</not>
			</and>
			<then>
				<ant dir="${sdk.dir}/shared/portal-compat-shared" target="compile" inheritAll="false" />
			</then>
		</if>

		<mkdir dir="classes" />

		<copy todir="classes">
			<fileset dir="src" excludes="**/*.java" />
		</copy>

		<antcall target="compile-java">
			<param name="javac.classpathref" value="plugin.classpath" />
			<param name="javac.destdir" value="classes" />
			<param name="javac.srcdir" value="src" />
		</antcall>
	</target>

	<target name="deploy" depends="jar">
	</target>

	<target name="jar" depends="compile">
		<mkdir dir="${sdk.dir}/dist" />

		<jar
			basedir="classes"
			jarfile="${plugin.file}"
		/>
	</target>

	<target name="javadoc">
		<if>
			<available file="src" />
			<then>
				<if>
					<available file="lib" />
					<then>
						<path id="plugin-lib.classpath">
							<fileset dir="lib" includes="*.jar" />
							<pathelement location="classes" />
							<pathelement location="${project.dir}/shared/portal-compat-shared/classes" />
						</path>
					</then>
					<else>
						<path id="plugin-lib.classpath">
							<pathelement location="classes" />
							<pathelement location="${project.dir}/shared/portal-compat-shared/classes" />
						</path>
					</else>
				</if>
				<antcall target="build-common.javadoc">
					<param name="javac.classpathref" value="plugin.classpath" />
					<param name="javac.srcdir" value="src" />
					<reference refid="plugin-lib.classpath" torefid="plugin-lib.classpath" />
				</antcall>
			</then>
		</if>
	</target>

	<target name="war">
		<antcall target="jar" />
	</target>

	<target name="publish-local-m2-release" depends="jar,javadoc,jar-javadoc,jar-source">
		<antcall target="build-common-ivy.publish-local-m2-release" />
	</target>

	<target name="publish-local-m2-snapshot" depends="jar,javadoc,jar-javadoc,jar-source">
		<antcall target="build-common-ivy.publish-local-m2-snapshot" />
	</target>

	<target name="publish-central-m2-release" depends="jar,javadoc,jar-javadoc,jar-source">
		<antcall target="build-common-ivy.publish-central-m2-release" />
	</target>

	<target name="publish-central-m2-snapshot" depends="jar,javadoc,jar-javadoc,jar-source">
		<antcall target="build-common-ivy.publish-central-m2-snapshot" />
	</target>
			
</project>